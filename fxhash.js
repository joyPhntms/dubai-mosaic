"use strict";(()=>{var t="123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz";function e(e){return[...e].reduce((function(e,n){return e*t.length+t.indexOf(n)|0}),0)}function n(t,n,r=e){return t.slice(n).match(new RegExp(".{"+(t.length-n>>2)+"}","g")).map(r)}function r(e){return function(t){let e=0|t[0],n=0|t[1],r=0|t[2],a=0|t[3];return function(){e|=0,n|=0,r|=0,a|=0;let t=(e+n|0)+a|0;return a=a+1|0,e=n^n>>>9,n=r+(r<<3)|0,r=r<<21|r>>>11,r=r+t|0,(t>>>0)/4294967296}}(function(e){return function(t){return/^(0x)?([A-Fa-f0-9]{64})$/.test(t)}(e)||function(t){return/^(0x)?[0-9a-fA-F]{40}$/.test(t)}(e)?n(e,2,(t=>0|parseInt(t,16))):function(e){if(36!==e.length)return!1;for(let n=0;n<e.length;n++)if(!t.includes(e[n]))return!1;return!0}(e)?n(e,3):n(e,2)}(e))}function a(t){let e=t.replace("#","");return 6===e.length&&(e=`${e}ff`),3===e.length&&(e=`${e[0]}${e[0]}${e[1]}${e[1]}${e[2]}${e[2]}ff`),e}var i=function(t){let e="";for(let n=0;n<t.length;n++)e+=t.charCodeAt(n).toString(16).padStart(4,"0");return e},s=BigInt("-9223372036854775808"),o=BigInt("9223372036854775807"),u={number:{serialize:t=>{let e=new DataView(new ArrayBuffer(8));return e.setFloat64(0,t),e.getBigUint64(0).toString(16).padStart(16,"0")},deserialize:t=>{let e=new DataView(new ArrayBuffer(8));for(let n=0;n<8;n++)e.setUint8(n,parseInt(t.substring(2*n,2*n+2),16));return e.getFloat64(0)},bytesLength:()=>8,constrain:(t,e)=>{let n=Number.MIN_SAFE_INTEGER;typeof e.options?.min<"u"&&(n=Number(e.options.min));let r=Number.MAX_SAFE_INTEGER;typeof e.options?.max<"u"&&(r=Number(e.options.max)),r=Math.min(r,Number.MAX_SAFE_INTEGER),n=Math.max(n,Number.MIN_SAFE_INTEGER);let a=Math.min(Math.max(t,n),r);if(e?.options?.step){let t=1/e?.options?.step;return Math.round(a*t)/t}return a},random:t=>{let e=Number.MIN_SAFE_INTEGER;typeof t.options?.min<"u"&&(e=Number(t.options.min));let n=Number.MAX_SAFE_INTEGER;typeof t.options?.max<"u"&&(n=Number(t.options.max)),n=Math.min(n,Number.MAX_SAFE_INTEGER),e=Math.max(e,Number.MIN_SAFE_INTEGER);let r=Math.random()*(n-e)+e;if(t?.options?.step){let e=1/t?.options?.step;return Math.round(r*e)/e}return r}},bigint:{serialize:t=>{let e=new DataView(new ArrayBuffer(8));return e.setBigInt64(0,BigInt(t)),e.getBigUint64(0).toString(16).padStart(16,"0")},deserialize:t=>{let e=new DataView(new ArrayBuffer(8));for(let n=0;n<8;n++)e.setUint8(n,parseInt(t.substring(2*n,2*n+2),16));return e.getBigInt64(0)},bytesLength:()=>8,random:t=>{let e=s,n=o;typeof t.options?.min<"u"&&(e=BigInt(t.options.min)),typeof t.options?.max<"u"&&(n=BigInt(t.options.max));let r,a=n-e,i=a.toString(2).length;do{r=BigInt("0b"+Array.from(crypto.getRandomValues(new Uint8Array(Math.ceil(i/8)))).map((t=>t.toString(2).padStart(8,"0"))).join(""))}while(r>a);return r+e}},boolean:{serialize:t=>"boolean"==typeof t?t?"01":"00":"string"==typeof t&&"true"===t?"01":"00",deserialize:t=>"00"!==t,bytesLength:()=>1,random:()=>Math.random()<.5},color:{serialize:t=>a(t),deserialize:t=>t,bytesLength:()=>4,transform:t=>{let e=a(t),n=parseInt(e.slice(0,2),16),r=parseInt(e.slice(2,4),16),i=parseInt(e.slice(4,6),16),s=parseInt(e.slice(6,8),16);return{hex:{rgb:"#"+t.slice(0,6),rgba:"#"+t},obj:{rgb:{r:n,g:r,b:i},rgba:{r:n,g:r,b:i,a:s}},arr:{rgb:[n,r,i],rgba:[n,r,i,s]}}},constrain:t=>t.replace("#","").slice(0,8).padEnd(8,"f"),random:()=>`${[...Array(8)].map((()=>Math.floor(16*Math.random()).toString(16))).join("")}`},string:{serialize:(t,e)=>{if(!e.version){let e=i(t.substring(0,64));return e=e.padEnd(256,"0"),e}let n=64;typeof e.options?.maxLength<"u"&&(n=Number(e.options.maxLength));let r=i(t.substring(0,n));return r=r.padEnd(4*n,"0"),r},deserialize:t=>function(t){let e=t.match(/.{1,4}/g)||[],n="";for(let t=0;t<e.length;t++){let r=parseInt(e[t],16);if(0===r)break;n+=String.fromCharCode(r)}return n}(t),bytesLength:t=>t.version&&typeof t.options?.maxLength<"u"?2*Number(t.options.maxLength):128,random:t=>{let e=0;typeof t.options?.minLength<"u"&&(e=t.options.minLength);let n=64;typeof t.options?.maxLength<"u"&&(n=t.options.maxLength);let r=Math.round(Math.random()*(n-e)+e);return[...Array(r)].map((t=>(~~(36*Math.random())).toString(36))).join("")},constrain:(t,e)=>{let n=0;typeof e.options?.minLength<"u"&&(n=e.options.minLength);let r=64;typeof e.options?.maxLength<"u"&&(r=e.options.maxLength);let a=t.slice(0,r);return a.length<n?a.padEnd(n):a}},bytes:{serialize:(t,e)=>Array.from(t).map((t=>t.toString(16).padStart(2,"0"))).join(""),deserialize:(t,e)=>{let n,r=t.length/2,a=new Uint8Array(r);for(let e=0;e<r;e++)n=2*e,a[e]=parseInt(`${t[n]}${t[n+1]}`,16);return a},bytesLength:t=>t.options.length,random:t=>{let e=t.options?.length||0,n=new Uint8Array(e);for(let t=0;t<e;t++)n[t]=255*Math.random()|0;return n}},select:{serialize:(t,e)=>Math.min(255,e.options?.options?.indexOf(t)||0).toString(16).padStart(2,"0"),deserialize:(t,e)=>{let n=parseInt(t,16);return e.options?.options?.[n]||e.options?.options?.[0]||""},bytesLength:()=>1,constrain:(t,e)=>e.options.options.includes(t)?t:e.options.options[0],random:t=>{let e=Math.round(Math.random()*(t.options.options.length-1)+0);return t?.options?.options[e]}}},p=(t,e,n)=>{let r={};for(let a of e){let e=u[a.type],i=t[a.id],s=e[n];r[a.id]=s?.(i,a)||i}return r};window.$fx=function(e,n){let{parent:a}=e,i=new URLSearchParams(e.location.search),s=i.get("fxhash")||`oo${Array.from({length:49},(()=>t[Math.random()*t.length|0])).join("")}`,o=r(s),l=i.get("fxminter")||`tz1${Array.from({length:33},(()=>t[Math.random()*t.length|0])).join("")}`,f=r(l),m="1"===i.get("preview"),h=e.location.hash?.replace("#0x",""),g={_version:"4.0.0",_processors:u,_params:void 0,_features:void 0,_paramValues:{},_listeners:{},_receiveUpdateParams:async function(t,e){let n=await this.propagateEvent("params:update",t);n.forEach((([n,r])=>{"boolean"==typeof n&&!n||(this._updateParams(t),e?.()),r?.(n,t)})),0===n.length&&(this._updateParams(t),e?.())},_updateParams:function(t){let e=p({...this._rawValues,...t},this._params,"constrain");Object.keys(e).forEach((t=>{this._rawValues[t]=e[t]})),this._paramValues=p(this._rawValues,this._params,"transform"),this._updateInputBytes()},_updateInputBytes:function(){let t=function(t,e){let n="";if(!e)return n;for(let r of e){let{id:e,type:a}=r,i=u[a],s=t[e],o=typeof s<"u"?s:typeof r.default<"u"?r.default:i.random(r);n+=i.serialize(o,r)}return n}(this._rawValues,this._params);this.inputBytes=t},_emitParams:function(t){let e=Object.keys(t).reduce(((e,n)=>(e[n]=((t,e,n,r)=>{let a=this._params.find((e=>e.id===t));return(0,u[a.type].constrain)?.(e,a)||e})(n,t[n]),e)),{});this._receiveUpdateParams(e,(()=>{a.postMessage({id:"fxhash_emit:params:update",data:{params:e}},"*")}))},hash:s,rand:o,minter:l,randminter:f,iteration:Number(i.get("fxiteration"))||1,context:i.get("fxcontext")||"standalone",preview:function t(){e.dispatchEvent(new Event("fxhash-preview")),setTimeout((()=>t()),500)},isPreview:m,params:function(t){this._params=t.map((t=>({...t,version:this._version}))),this._rawValues=function(t,e,n){let r={};for(let a of e){let e=u[a.type],i=n.withTransform&&e[n.transformType||"transform"];if(!t){let t;t=typeof a.default>"u"?e.random(a):a.default,r[a.id]=i?i(t,a):t;continue}let s=e.bytesLength(a),o=t.substring(0,2*s);t=t.substring(2*s);let p=e.deserialize(o,a);r[a.id]=i?i(p,a):p}return r}(h,this._params,{withTransform:!0,transformType:"constrain"}),this._paramValues=p(this._rawValues,this._params,"transform"),this._updateInputBytes()},features:function(t){this._features=t},getFeature:function(t){return this._features[t]},getFeatures:function(){return this._features},getParam:function(t){return this._paramValues[t]},getParams:function(){return this._paramValues},getRawParam:function(t){return this._rawValues[t]},getRawParams:function(){return this._rawValues},getRandomParam:function(t){let e=this._params.find((e=>e.id===t));return u[e.type].random(e)},getDefinitions:function(){return this._params},stringifyParams:function(t){return JSON.stringify(t||this._rawValues,((t,e)=>"bigint"==typeof e?e.toString():e),2)},on:function(t,e,n){return this._listeners[t]||(this._listeners[t]=[]),this._listeners[t].push([e,n]),()=>{let n=this._listeners[t].findIndex((([t])=>t===e));n>-1&&this._listeners[t].splice(n,1)}},propagateEvent:async function(t,e){let n=[];if(this._listeners?.[t])for(let[r,a]of this._listeners[t]){let t=r(e);n.push([t instanceof Promise?await t:t,a])}return n},emit:function(t,e){"params:update"===t?this._emitParams(e):console.log("$fx.emit called with unknown id:",t)}},d=()=>{o=r(s),g.rand=o,o.reset=d};o.reset=d;let c=()=>{f=r(l),g.randminter=f,f.reset=c};return f.reset=c,e.addEventListener("message",(t=>{if("fxhash_getInfo"===t.data&&a.postMessage({id:"fxhash_getInfo",data:{version:e.$fx._version,hash:e.$fx.hash,iteration:e.$fx.iteration,features:e.$fx.getFeatures(),params:{definitions:e.$fx.getDefinitions(),values:e.$fx.getRawParams()},minter:e.$fx.minter}},"*"),"fxhash_params:update"===t.data?.id){let{params:n}=t.data.data;n&&e.$fx._receiveUpdateParams(n)}})),g}(window)})();